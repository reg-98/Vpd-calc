<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grow VPD Monitor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    input, select {
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      width: 100%;
    }
    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: #222;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
    }
    .output {
      margin-top: 20px;
      background: #333;
      padding: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸŒ± Grow Room VPD Calculator</h2>

    <label for="temp">Air Temperature (Â°C):</label>
    <input type="number" id="temp" step="0.1" />

    <label for="rh">Relative Humidity (%):</label>
    <input type="number" id="rh" step="0.1" />

    <label for="stage">Growth Stage:</label>
    <select id="stage">
      <option value="veg">Vegetative</option>
      <option value="early_flower">Early Flower</option>
      <option value="late_flower">Late Flower</option>
    </select>

    <label for="offset">Leaf Temp Offset (Â°C):</label>
    <input type="number" id="offset" step="0.1" value="0.5"/>

    <button onclick="calculate()">Calculate VPD</button>

    <div class="output" id="result"></div>
  </div>

  <script>
    const vpdTargets = {
      veg: { min: 0.8, max: 1.2 },
      early_flower: { min: 1.2, max: 1.5 },
      late_flower: { min: 1.4, max: 1.6 }
    };

    function saturationVapourPressure(temp) {
      return 0.6108 * Math.exp((17.27 * temp) / (temp + 237.3));
    }

    function calculateVPD(temp, rh, offset) {
      const leafTemp = temp - offset;
      const es = saturationVapourPressure(leafTemp);
      const ea = es * (rh / 100);
      return +(es - ea).toFixed(2);
    }

    function getRecommendations(vpd, stage, temp, rh) {
      const { min, max } = vpdTargets[stage];
      let tempChange = 0;
      let rhChange = 0;
      let advice = "";

      if (vpd < min) {
        tempChange = +1;
        rhChange = -5;
        advice = `VPD too low â€” increase temp by 1Â°C or reduce RH by 5%.`;
      } else if (vpd > max) {
        tempChange = -1;
        rhChange = +5;
        advice = `VPD too high â€” lower temp by 1Â°C or raise RH by 5%.`;
      } else {
        advice = "âœ… VPD is within the ideal range.";
      }

      return {
        newTemp: temp + tempChange,
        newRH: Math.min(100, Math.max(0, rh + rhChange)),
        advice
      };
    }

    function calculate() {
      const temp = parseFloat(document.getElementById("temp").value);
      const rh = parseFloat(document.getElementById("rh").value);
      const stage = document.getElementById("stage").value;
      const offset = parseFloat(document.getElementById("offset").value);

      if (isNaN(temp) || isNaN(rh) || isNaN(offset)) {
        document.getElementById("result").innerHTML = `<p>Please enter valid values.</p>`;
        return;
      }

      const vpd = calculateVPD(temp, rh, offset);
      const rec = getRecommendations(vpd, stage, temp, rh);

      document.getElementById("result").innerHTML = `
        <p><strong>Current VPD:</strong> ${vpd} kPa</p>
        <p><strong>Suggested Action:</strong> ${rec.advice}</p>
        <p><strong>Adjusted Temp:</strong> ${rec.newTemp.toFixed(1)}Â°C</p>
        <p><strong>Adjusted RH:</strong> ${rec.newRH.toFixed(1)}%</p>
      `;
    }
  </script>
</body>
</html>
